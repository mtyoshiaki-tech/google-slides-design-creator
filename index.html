<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
ã€€ã€€<meta name="robots" content="noindex"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Googleã‚¹ãƒ©ã‚¤ãƒ‰è¨­è¨ˆã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=BIZ+UDPGothic:wght@400;700&family=Noto+Sans+JP:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #111827; /* Dark Mode Bg */
            color: #f3f4f6;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }

        .code-block {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            background-color: #000000;
            color: #4ade80; /* Matrix green text */
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            white-space: pre;
            font-size: 0.875rem;
            line-height: 1.5;
            border: 1px solid #374151;
        }

        .step-active {
            background-color: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }
        
        .step-inactive {
            background-color: #374151;
            border-color: #4b5563;
            color: #9ca3af;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Input autofill fix for dark mode */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active{
            -webkit-box-shadow: 0 0 0 30px #374151 inset !important;
            -webkit-text-fill-color: white !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-gray-800 shadow-lg sticky top-0 z-50 border-b border-gray-700">
        <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 text-white p-2 rounded-lg shadow-blue-500/50 shadow-md">
                    <!-- Icon changed to pen-ruler for "Design/Create" feel -->
                    <i class="fas fa-pen-ruler text-xl"></i>
                </div>
                <div>
                    <!-- Updated Title & Subtitle (Option A) -->
                    <h1 class="text-xl font-bold text-gray-100">Googleã‚¹ãƒ©ã‚¤ãƒ‰è¨­è¨ˆã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼</h1>
                    <p class="text-xs text-gray-400">Geminiã§ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãŸã‚ã®æŒ‡ç¤ºæ›¸ä½œæˆãƒ„ãƒ¼ãƒ«</p>
                </div>
            </div>
            <div class="text-sm font-medium text-blue-400" id="phase-indicator">
                è¦ä»¶å®šç¾©
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-4xl mx-auto w-full px-4 py-8">
        
        <!-- Progress Steps -->
        <div class="flex justify-between mb-10 relative px-10">
            <div class="absolute top-1/2 left-0 w-full h-0.5 bg-gray-700 -z-10 transform -translate-y-1/2"></div>
            
            <!-- Step 1: è¨­å®š -->
            <div id="step-0" class="flex flex-col items-center bg-gray-800 px-4 rounded-full z-10">
                <div class="w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold step-active transition-colors shadow-lg">1</div>
                <span class="text-xs mt-2 font-bold text-blue-400">è¦ä»¶å®šç¾©</span>
            </div>
            
            <!-- Step 2: å‡ºåŠ› -->
            <div id="step-output" class="flex flex-col items-center bg-gray-800 px-4 rounded-full z-10">
                <div class="w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold step-inactive transition-colors shadow-lg">2</div>
                <span class="text-xs mt-2 font-bold text-gray-500">å‡ºåŠ›</span>
            </div>
        </div>

        <!-- PHASE 0: Input Form -->
        <section id="phase-0" class="bg-gray-800 rounded-xl shadow-xl p-6 md:p-8 animate-fade-in border border-gray-700">
            <h2 class="text-2xl font-bold text-gray-100 mb-6 border-b border-gray-700 pb-4 flex items-center">
                <i class="fas fa-sliders-h text-blue-500 mr-3"></i>ã‚¹ãƒ©ã‚¤ãƒ‰è¦ä»¶ã®å®šç¾©
            </h2>
            
            <!-- 1. Theme -->
            <div class="mb-10">
                <label class="block text-sm font-bold text-gray-300 mb-2">â‘  ãƒ†ãƒ¼ãƒ (Theme)</label>
                <input type="text" id="input-theme" placeholder="ä¾‹ï¼šä¿®å­¦æ—…è¡Œã®èª¬æ˜ã€å…‰åˆæˆã®ä»•çµ„ã¿ã€é€²è·¯é¸æŠã«ã¤ã„ã¦" 
                    class="w-full p-4 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition text-lg shadow-inner">
            </div>

            <!-- 2. Target Audience -->
            <div class="mb-10">
                <label class="block text-sm font-bold text-gray-300 mb-4">â‘¡ å¯¾è±¡ (Target)</label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <button onclick="selectTarget('elementary')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="elementary">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ’</span>
                        <span class="text-sm font-bold text-gray-200">å°å­¦éƒ¨</span>
                    </button>
                    <button onclick="selectTarget('middle')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="middle">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ«</span>
                        <span class="text-sm font-bold text-gray-200">ä¸­å­¦éƒ¨</span>
                    </button>
                    <button onclick="selectTarget('high')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="high">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ“</span>
                        <span class="text-sm font-bold text-gray-200">é«˜ç­‰éƒ¨</span>
                    </button>
                    <button onclick="selectTarget('teachers')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="teachers">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ‘©â€ğŸ«</span>
                        <span class="text-sm font-bold text-gray-200">æ•™å“¡å‘ã‘</span>
                    </button>
                    <button onclick="selectTarget('parents')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="parents">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                        <span class="text-sm font-bold text-gray-200">ä¿è­·è€…å‘ã‘</span>
                    </button>
                    <button onclick="selectTarget('universal')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="universal">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ‘ï¸</span>
                        <span class="text-sm font-bold text-gray-200">ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«</span>
                    </button>
                </div>
            </div>

            <!-- 3. Design Selection (Hidden until Target is selected) -->
            <div id="design-section" class="mb-10 hidden animate-fade-in">
                <label class="block text-sm font-bold text-gray-300 mb-4">â‘¢ ãƒ‡ã‚¶ã‚¤ãƒ³ (Design) - 12ç¨®é¡ã‹ã‚‰é¸æŠ</label>
                <div id="design-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <!-- Javascript will populate this -->
                </div>
                
                <!-- 4. Option (UD Font) -->
                <div class="pt-6 border-t border-gray-700">
                    <label class="block text-sm font-bold text-gray-300 mb-4">â‘£ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ (Option)</label>
                    <label class="flex items-center gap-4 p-4 bg-gray-700 border border-gray-600 rounded-lg cursor-pointer hover:bg-gray-600 transition group">
                        <!-- Checked by default -->
                        <input type="checkbox" id="input-udfont" class="w-6 h-6 text-blue-600 rounded bg-gray-800 border-gray-500 focus:ring-blue-500 focus:ring-offset-gray-800" checked>
                        <div>
                            <span class="block text-base font-bold text-gray-200 group-hover:text-white">UDãƒ•ã‚©ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹</span>
                            <span class="block text-xs text-gray-400 mt-1">ã€ŒBIZ UDPã‚´ã‚·ãƒƒã‚¯ã€ã‚’æŒ‡å®šã—ã€èª­ã¿ã‚„ã™ã•ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Action -->
            <div class="text-center pt-8">
                <button onclick="generateAndGoToOutput()" id="btn-generate-proposal" disabled 
                    class="bg-gray-600 text-gray-400 font-bold py-4 px-12 rounded-full shadow-lg cursor-not-allowed transition-all transform text-lg border border-gray-600 w-full md:w-auto hover:shadow-blue-900/50">
                    <i class="fas fa-magic mr-2"></i>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆã™ã‚‹
                </button>
                <p id="error-msg" class="text-red-400 text-sm mt-3 hidden bg-red-900/30 py-2 rounded border border-red-900/50 inline-block px-4">å…¨ã¦ã®é …ç›®ï¼ˆãƒ†ãƒ¼ãƒãƒ»å¯¾è±¡ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            </div>
        </section>


        <!-- PHASE 2: Final Output -->
        <section id="phase-2" class="hidden animate-fade-in">
            <div class="bg-gray-800 rounded-xl shadow-xl p-6 md:p-8 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-100 flex items-center gap-3">
                        <div class="bg-green-500/20 p-2 rounded-lg">
                            <i class="fas fa-check text-green-500"></i>
                        </div>
                        AIæŒ‡ç¤ºæ›¸ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã®ç”Ÿæˆå®Œäº†
                    </h2>
                    <button onclick="backToPhase0()" class="text-sm text-gray-400 hover:text-blue-400 underline transition">
                        è¦ä»¶ã‚’ä¿®æ­£ã™ã‚‹
                    </button>
                </div>
                
                <p class="text-gray-400 mb-6 text-sm leading-relaxed">
                    ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ã€GEMï¼ˆAIï¼‰ã«å¯¾ã™ã‚‹<strong>ã€Œã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆæŒ‡ç¤ºæ›¸ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã€</strong>ã§ã™ã€‚<br>
                    ã“ã‚Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦GEMã«æ¸¡ã™ã¨ã€AIãŒæŒ‡ç¤ºå†…å®¹ã‚’å®Œå…¨ã«ç†è§£ã—ã€æœ€é©ãªGoogleã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
                </p>

                <!-- Actions Toolbar -->
                <div class="flex flex-wrap items-center justify-end gap-4 mb-4">
                    <button onclick="copyToClipboard()" class="bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-500 hover:to-cyan-400 text-white text-base px-8 py-3 rounded-lg shadow-xl transition flex items-center gap-2 font-extrabold transform hover:scale-105 border border-white/20">
                        <i class="fas fa-copy"></i> â‘ ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
                    </button>
                    <a href="https://gemini.google.com/gem/1IyiaDM91R8aOpYBN3-Svgprwd5bC37uQ?usp=sharing" target="_blank" rel="noopener noreferrer" 
                       class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 hover:from-indigo-500 hover:via-purple-500 hover:to-pink-500 text-white text-base px-8 py-3 rounded-lg shadow-xl transition flex items-center gap-2 font-extrabold no-underline transform hover:scale-105 border border-white/20">
                        <i class="fas fa-sparkles"></i> â‘¡NEW Chat
                    </a>
                </div>

                <div class="relative group">
                    <pre id="final-code" class="code-block h-96 overflow-y-auto custom-scrollbar shadow-inner"></pre>
                </div>

                <div class="mt-10 text-center">
                    <button onclick="location.reload()" class="px-8 py-3 text-blue-400 font-bold hover:bg-blue-900/30 hover:text-blue-300 rounded-lg transition border border-transparent hover:border-blue-900">
                        <i class="fas fa-redo mr-2"></i>æ–°ã—ã„ãƒ†ãƒ¼ãƒã§ä½œæˆã™ã‚‹
                    </button>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 border-t border-gray-700 mt-auto py-8">
        <div class="max-w-5xl mx-auto px-4 text-center text-gray-500 text-xs">
            <p class="mb-2 font-bold text-gray-400">EduSlide Architect</p>
            <p>&copy; 2025 Education Slide Architect / Based on GEM Custom Instructions</p>
        </div>
    </footer>

    <!-- JavaScript Application Logic -->
    <script>
        // --- Data Definitions (Target x Design Matrix: Expanded to 12) ---
        const designMatrix = {
            elementary: {
                name: "å°å­¦éƒ¨å‘ã‘ (Elementary)",
                patterns: [
                    { id: "A", name: "ã€å…ƒæ°—ãƒ»ãƒãƒƒãƒ—ã€‘", colors: ["#FDD835", "#FB8C00", "#039BE5"], desc: "æ¥½ã—ã„ãƒ»ã‚²ãƒ¼ãƒ æ„Ÿè¦š" },
                    { id: "B", name: "ã€ã‚„ã•ã—ã„ãƒ»çµµæœ¬ã€‘", colors: ["#F8BBD0", "#B2EBF2", "#FFF9C4"], desc: "å®‰å¿ƒãƒ»ç‰©èªèª¿" },
                    { id: "C", name: "ã€æ¢æ±‚ãƒ»å†’é™ºã€‘", colors: ["#66BB6A", "#8D6E63", "#FFCA28"], desc: "å†’é™ºãƒ»ç™ºè¦‹" },
                    { id: "D", name: "ã€æµ·ãƒ»ã‚ªãƒ¼ã‚·ãƒ£ãƒ³ã€‘", colors: ["#0288D1", "#4FC3F7", "#E1F5FE"], desc: "çˆ½ã‚„ã‹ãƒ»åºƒå¤§" },
                    { id: "E", name: "ã€æ£®ãƒ»ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã€‘", colors: ["#33691E", "#8BC34A", "#DCEDC8"], desc: "è‡ªç„¶ãƒ»ãƒªãƒ©ãƒƒã‚¯ã‚¹" },
                    { id: "F", name: "ã€å¤ªé™½ãƒ»ã‚µãƒ³ã‚·ãƒ£ã‚¤ãƒ³ã€‘", colors: ["#F57F17", "#FFEB3B", "#FFF9C4"], desc: "æ˜ã‚‹ã„ãƒ»å…ƒæ°—" },
                    { id: "G", name: "ã€å®‡å®™ãƒ»ã‚³ã‚¹ãƒ¢ã€‘", colors: ["#311B92", "#673AB7", "#FFEB3B"], desc: "ç¥ç§˜ãƒ»ç§‘å­¦" },
                    { id: "H", name: "ã€ã‚­ãƒ£ãƒ³ãƒ‡ã‚£ãƒ»ã‚¹ã‚¤ãƒ¼ãƒˆã€‘", colors: ["#EC407A", "#AB47BC", "#F8BBD0"], desc: "å¯æ„›ã„ãƒ»å¤¢" },
                    { id: "I", name: "ã€ã‚¹ãƒãƒ¼ãƒ„ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã€‘", colors: ["#D32F2F", "#FFFFFF", "#212121"], desc: "æƒ…ç†±ãƒ»é‹å‹•" },
                    { id: "J", name: "ã€å‹•ç‰©ãƒ»ã‚¢ãƒ‹ãƒãƒ«ã€‘", colors: ["#795548", "#A1887F", "#D7CCC8"], desc: "æ¸©ã‚‚ã‚Šãƒ»ç”Ÿå‘½" },
                    { id: "K", name: "ã€è™¹ãƒ»ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ã€‘", colors: ["#FF5722", "#FFC107", "#00BCD4"], desc: "å¤šæ§˜æ€§ãƒ»å¸Œæœ›" },
                    { id: "L", name: "ã€ã‚¹ã‚±ãƒƒãƒãƒ»æ‰‹æãã€‘", colors: ["#FFFFFF", "#212121", "#BDBDBD"], desc: "è‡ªç”±ãƒ»å‰µé€ " }
                ]
            },
            middle: {
                name: "ä¸­å­¦éƒ¨å‘ã‘ (Middle School)",
                patterns: [
                    { id: "A", name: "ã€å­¦æ ¡ãƒ»é»’æ¿ã€‘", colors: ["#263238", "#FFFFFF", "#FFF176"], desc: "å­¦ç¿’ãƒ»é›†ä¸­" },
                    { id: "B", name: "ã€éƒ¨æ´»ãƒ»ã‚¹ãƒãƒ¼ãƒ„ã€‘", colors: ["#1565C0", "#FF6F00", "#EEEEEE"], desc: "çˆ½ã‚„ã‹ãƒ»å›£çµ" },
                    { id: "C", name: "ã€æ•´ç†ãƒ»ãƒãƒ¼ãƒˆã€‘", colors: ["#ECEFF1", "#283593", "#546E7A"], desc: "æ•´ç†æ•´é “" },
                    { id: "D", name: "ã€ãƒ†ãƒƒã‚¯ãƒ»ãƒ€ãƒ¼ã‚¯ã€‘", colors: ["#000000", "#00E676", "#212121"], desc: "æŠ€è¡“ãƒ»ã‹ã£ã“ã„ã„" },
                    { id: "E", name: "ã€ãƒãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆã€‘", colors: ["#D500F9", "#00E5FF", "#FFEA00"], desc: "å€‹æ€§çš„ãƒ»ç¾è¡“" },
                    { id: "F", name: "ã€ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ã€‘", colors: ["#5D4037", "#D7CCC8", "#FFECB3"], desc: "æ­´å²ãƒ»ä¼çµ±" },
                    { id: "G", name: "ã€å¹¾ä½•å­¦ãƒ»ã‚¸ã‚ªãƒ¡ãƒˆãƒªã€‘", colors: ["#37474F", "#90A4AE", "#CFD8DC"], desc: "æ•°å­¦ãƒ»è«–ç†" },
                    { id: "H", name: "ã€ã‚¨ã‚³ãƒ»ãƒã‚¤ãƒãƒ£ãƒ¼ã€‘", colors: ["#1B5E20", "#FFFFFF", "#81C784"], desc: "ç’°å¢ƒãƒ»æ¸…æ½”" },
                    { id: "I", name: "ã€ã‚³ã‚¹ãƒ¢ã‚¹ãƒ»å¤œç©ºã€‘", colors: ["#1A237E", "#000000", "#E040FB"], desc: "æ·±é ãƒ»æ€è€ƒ" },
                    { id: "J", name: "ã€ã‚¢ãƒ¼ãƒãƒ³ãƒ»ã‚·ãƒ†ã‚£ã€‘", colors: ["#424242", "#FFC107", "#EEEEEE"], desc: "éƒ½ä¼šçš„ãƒ»ç¤¾ä¼š" },
                    { id: "K", name: "ã€ãƒ¢ãƒã‚¯ãƒ­ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ã€‘", colors: ["#212121", "#FFFFFF", "#9E9E9E"], desc: "ç¡¬æ´¾ãƒ»çœŸå‰£" },
                    { id: "L", name: "ã€å¤•ç„¼ã‘ãƒ»ã‚µãƒ³ã‚»ãƒƒãƒˆã€‘", colors: ["#BF360C", "#FF5722", "#4527A0"], desc: "æƒ…å‹•ãƒ»å¤‰åŒ–" }
                ]
            },
            high: {
                name: "é«˜ç­‰éƒ¨å‘ã‘ (High School)",
                patterns: [
                    { id: "A", name: "ã€é€²è·¯ãƒ»ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯ã€‘", colors: ["#1A237E", "#B71C1C", "#F5F5F5"], desc: "çœŸé¢ç›®ãƒ»è¬›ç¾©" },
                    { id: "B", name: "ã€ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ»ãƒ¢ãƒ€ãƒ³ã€‘", colors: ["#212121", "#00E676", "#FFFFFF"], desc: "éƒ½ä¼šçš„ãƒ»æœ€å…ˆç«¯" },
                    { id: "C", name: "ã€ã‚·ãƒ³ãƒ—ãƒ«ãƒ»ãƒŸãƒ‹ãƒãƒ«ã€‘", colors: ["#FAFAFA", "#424242", "#00ACC1"], desc: "æœ¬è³ªçš„ãƒ»å¤§äºº" },
                    { id: "D", name: "ã€ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã€‘", colors: ["#0277BD", "#FFFFFF", "#B0BEC5"], desc: "ãƒ“ã‚¸ãƒã‚¹ãƒ»é©æ–°" },
                    { id: "E", name: "ã€ãƒ¢ãƒ€ãƒ‹ã‚ºãƒ ã€‘", colors: ["#B71C1C", "#212121", "#FFFFFF"], desc: "é‹­åˆ©ãƒ»èŠ¸è¡“" },
                    { id: "F", name: "ã€ãƒã‚¤ãƒãƒ£ãƒ¼ãƒ†ãƒƒã‚¯ã€‘", colors: ["#33691E", "#CFD8DC", "#FFFFFF"], desc: "èª¿å’Œãƒ»æœªæ¥" },
                    { id: "G", name: "ã€ãƒ©ã‚°ã‚¸ãƒ¥ã‚¢ãƒªãƒ¼ã€‘", colors: ["#000000", "#FFD700", "#424242"], desc: "é«˜ç´šãƒ»ç‰¹åˆ¥" },
                    { id: "H", name: "ã€ã‚¨ãƒ‡ã‚£ãƒˆãƒªã‚¢ãƒ«ã€‘", colors: ["#3E2723", "#EFEBE9", "#8D6E63"], desc: "æ–‡å­¦ãƒ»è¨˜äº‹" },
                    { id: "I", name: "ã€ã‚µã‚¤ãƒãƒ¼ãƒ»ãƒã‚ªãƒ³ã€‘", colors: ["#0D47A1", "#F50057", "#00E5FF"], desc: "æƒ…å ±ãƒ»é›»è„³" },
                    { id: "J", name: "ã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã€‘", colors: ["#0D47A1", "#FFF8E1", "#FF6F00"], desc: "ä¼çµ±ãƒ»æ ¼å¼" },
                    { id: "K", name: "ã€ãƒ©ãƒœãƒ»ç ”ç©¶æ‰€ã€‘", colors: ["#FFFFFF", "#0288D1", "#E1F5FE"], desc: "æ¸…æ½”ãƒ»ç†ç³»" },
                    { id: "L", name: "ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‘", colors: ["#546E7A", "#B0BEC5", "#ECEFF1"], desc: "æ§‹é€ ãƒ»å·¥å­¦" }
                ]
            },
            teachers: {
                name: "æ•™å“¡å‘ã‘ (For Teachers)",
                patterns: [
                    { id: "A", name: "ã€å…¬å¼ãƒ»æ¨™æº–ã€‘", colors: ["#37474F", "#0277BD", "#FFFFFF"], desc: "ä¿¡é ¼ãƒ»å…¬å¼" },
                    { id: "B", name: "ã€ç ”ä¿®ãƒ»ã‚³ãƒ©ãƒœã€‘", colors: ["#FF7043", "#81C784", "#FFF3E0"], desc: "å‚åŠ ãƒ»äº¤æµ" },
                    { id: "C", name: "ã€é…å¸ƒãƒ»ãƒ—ãƒªãƒ³ãƒˆã€‘", colors: ["#FFFFFF", "#000000", "#757575"], desc: "å®Ÿå‹™ãƒ»ç¯€ç´„" },
                    { id: "D", name: "ã€ãƒˆãƒ©ã‚¹ãƒˆãƒ»ãƒ–ãƒ«ãƒ¼ã€‘", colors: ["#1565C0", "#90CAF9", "#E3F2FD"], desc: "èª å®Ÿãƒ»å†·é™" },
                    { id: "E", name: "ã€ã‚¦ã‚©ãƒ¼ãƒ ãƒ»ã‚ªãƒ¬ãƒ³ã‚¸ã€‘", colors: ["#E65100", "#FFE0B2", "#FFF3E0"], desc: "æ¸©ã‹ã•ãƒ»æ”¯æ´" },
                    { id: "F", name: "ã€ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ»ãƒŸãƒ³ãƒˆã€‘", colors: ["#2E7D32", "#A5D6A7", "#E8F5E9"], desc: "æˆé•·ãƒ»æ–°äºº" },
                    { id: "G", name: "ã€åˆ†æãƒ»ã‚¢ãƒŠãƒªã‚·ã‚¹ã€‘", colors: ["#000066", "#CC0000", "#EEEEEE"], desc: "ãƒ‡ãƒ¼ã‚¿ãƒ»é‡è¦" },
                    { id: "H", name: "ã€ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã€‘", colors: ["#FFD600", "#00BCD4", "#F5F5F5"], desc: "ã‚¢ã‚¤ãƒ‡ã‚¢ãƒ»ä»˜ç®‹" },
                    { id: "I", name: "ã€ãƒˆãƒ©ãƒ‡ã‚£ã‚·ãƒ§ãƒŠãƒ«ã€‘", colors: ["#4E342E", "#D7CCC8", "#FFFFFF"], desc: "ä¼çµ±ãƒ»é‡åš" },
                    { id: "J", name: "ã€ã‚«ãƒ¼ãƒ ãƒ»ãƒ†ã‚£ãƒ¼ãƒ«ã€‘", colors: ["#00695C", "#B2DFDB", "#FFFFFF"], desc: "è½ã¡ç€ããƒ»é›†ä¸­" },
                    { id: "K", name: "ã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã€‘", colors: ["#212121", "#FFFFFF", "#FF5252"], desc: "è¦ç‚¹ãƒ»å¼·èª¿" },
                    { id: "L", name: "ã€ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã€‘", colors: ["#6A1B9A", "#FFEB3B", "#F3E5F5"], desc: "å‰µé€ ãƒ»ææ¡ˆ" }
                ]
            },
            parents: {
                name: "ä¿è­·è€…å‘ã‘ (For Parents)",
                patterns: [
                    { id: "A", name: "ã€èª å®Ÿãƒ»ä¿¡é ¼ã€‘", colors: ["#0D47A1", "#D4AF37", "#E3F2FD"], desc: "èª å®Ÿãƒ»ç¤¼å„€" },
                    { id: "B", name: "ã€æ¸©ã‚‚ã‚Šãƒ»å®‰å¿ƒã€‘", colors: ["#8D6E63", "#C5E1A5", "#FFF8E1"], desc: "æ¸©ã‹ã„ãƒ»æ­“è¿" },
                    { id: "C", name: "ã€æˆé•·ãƒ»æœªæ¥ã€‘", colors: ["#4CAF50", "#FFFFFF", "#81D4FA"], desc: "æˆé•·ãƒ»çˆ½ã‚„ã‹" },
                    { id: "D", name: "ã€ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆã€‘", colors: ["#7E57C2", "#EDE7F6", "#FFFFFF"], desc: "ä¸Šå“ãƒ»ä¸å¯§" },
                    { id: "E", name: "ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã€‘", colors: ["#FF9800", "#8BC34A", "#FFF3E0"], desc: "åœ°åŸŸãƒ»å”åŠ›" },
                    { id: "F", name: "ã€ã‚»ãƒ¼ãƒ•ãƒ†ã‚£ã€‘", colors: ["#1976D2", "#FFC107", "#E3F2FD"], desc: "å®‰å…¨ãƒ»æ³¨æ„" },
                    { id: "G", name: "ã€ä¼çµ±ãƒ»å’Œé¢¨ã€‘", colors: ["#880E4F", "#C5E1A5", "#FCE4EC"], desc: "è¡Œäº‹ãƒ»ç¥è³€" },
                    { id: "H", name: "ã€ã‚¹ãƒ—ãƒªãƒ³ã‚°ã€‘", colors: ["#F06292", "#AED581", "#FFFDE7"], desc: "æ˜¥ãƒ»å§‹ã¾ã‚Š" },
                    { id: "I", name: "ã€ã‚ªãƒ¼ã‚¿ãƒ ã€‘", colors: ["#E64A19", "#FFB74D", "#5D4037"], desc: "ç§‹ãƒ»å®Ÿã‚Š" },
                    { id: "J", name: "ã€ã‚¹ã‚«ã‚¤ãƒ»ç©ºã€‘", colors: ["#039BE5", "#B3E5FC", "#FFFFFF"], desc: "åºƒã„å¿ƒãƒ»å±•æœ›" },
                    { id: "K", name: "ã€ã‚¢ãƒ¼ã‚¹ãƒ»å¤§åœ°ã€‘", colors: ["#5D4037", "#8BC34A", "#EFEBE9"], desc: "å …å®Ÿãƒ»åŸºç›¤" },
                    { id: "L", name: "ã€ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ã€‘", colors: ["#BA68C8", "#4DD0E1", "#F8BBD0"], desc: "èª¿å’Œãƒ»å¤šæ§˜" }
                ]
            },
            universal: {
                name: "ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ« (Universal)",
                patterns: [
                    { id: "A", name: "ã€ç™½èƒŒæ™¯ãƒã‚¤ã‚³ãƒ³ã€‘", colors: ["#FFFFFF", "#000000", "#005AFF"], desc: "æœ€å¤§è¦–èªæ€§" },
                    { id: "B", name: "ã€é»’èƒŒæ™¯ãƒã‚¤ã‚³ãƒ³ã€‘", colors: ["#000000", "#FFFFFF", "#FFD600"], desc: "ç›®ã¸ã®è² æ‹…æ¸›" },
                    { id: "C", name: "ã€UDã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã€‘", colors: ["#FFFFFF", "#333333", "#FF5722"], desc: "è‰²è¦šãƒãƒªã‚¢ãƒ•ãƒªãƒ¼" },
                    { id: "D", name: "ã€CUDæ¨å¥¨ãƒ»é’é»„ã€‘", colors: ["#005AFF", "#FFD600", "#FFFFFF"], desc: "CUDæ¨å¥¨é…è‰²" },
                    { id: "E", name: "ã€ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ã€‘", colors: ["#FFFFFF", "#000000", "#757575"], desc: "è‰²æƒ…å ±ãªã—" },
                    { id: "F", name: "ã€ã‚»ãƒ”ã‚¢ãƒ»èª­æ›¸ã€‘", colors: ["#F4ECD8", "#5D4037", "#8D6E63"], desc: "ä½ãƒ–ãƒ«ãƒ¼ãƒ©ã‚¤ãƒˆ" },
                    { id: "G", name: "ã€ãƒ€ãƒ¼ã‚¯ãƒ–ãƒ«ãƒ¼ã€‘", colors: ["#0D47A1", "#E3F2FD", "#90CAF9"], desc: "è½ã¡ç€ã" },
                    { id: "H", name: "ã€ã‚¯ãƒªãƒ¼ãƒ ã€‘", colors: ["#FFF9C4", "#212121", "#3E2723"], desc: "ä½ã‚°ãƒ¬ã‚¢" },
                    { id: "I", name: "ã€HCã‚¤ã‚¨ãƒ­ãƒ¼ã€‘", colors: ["#000000", "#FFFF00", "#FFFFFF"], desc: "è¶…é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ" },
                    { id: "J", name: "ã€HCã‚·ã‚¢ãƒ³ã€‘", colors: ["#000000", "#00FFFF", "#FFFFFF"], desc: "è¶…é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ" },
                    { id: "K", name: "ã€ã‚½ãƒ•ãƒˆãƒ€ãƒ¼ã‚¯ã€‘", colors: ["#303030", "#E0E0E0", "#B0BEC5"], desc: "æŸ”ã‚‰ã‹ã„é»’" },
                    { id: "L", name: "ã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒ©ã‚¤ãƒˆã€‘", colors: ["#FAFAFA", "#1A237E", "#283593"], desc: "æ–‡å­—ä¸­å¿ƒ" }
                ]
            }
        };

        // --- State Management ---
        let state = {
            theme: "",
            targetKey: "",
            patternId: "",
            udFont: true // Default true
        };

        // --- DOM Elements ---
        const els = {
            inputTheme: document.getElementById('input-theme'),
            inputUdFont: document.getElementById('input-udfont'),
            designSection: document.getElementById('design-section'),
            designContainer: document.getElementById('design-container'),
            btnGenerate: document.getElementById('btn-generate-proposal'),
            errorMsg: document.getElementById('error-msg'),
            phaseIndicator: document.getElementById('phase-indicator'),
            // Steps
            step0: document.getElementById('step-0'),
            stepOutput: document.getElementById('step-output'),
            // Phases
            phase0: document.getElementById('phase-0'),
            phase2: document.getElementById('phase-2'),
            // Final Output
            finalCode: document.getElementById('final-code')
        };

        // --- Event Listeners ---
        els.inputTheme.addEventListener('input', (e) => {
            state.theme = e.target.value;
            checkValidity();
        });

        els.inputUdFont.addEventListener('change', (e) => {
            state.udFont = e.target.checked;
        });

        function checkValidity() {
            if (state.theme && state.targetKey && state.patternId) {
                els.btnGenerate.disabled = false;
                els.btnGenerate.classList.remove('bg-gray-600', 'cursor-not-allowed', 'text-gray-400', 'border-gray-600');
                els.btnGenerate.classList.add('bg-blue-600', 'hover:bg-blue-500', 'cursor-pointer', 'text-white', 'border-blue-600', 'shadow-blue-900/50');
                els.errorMsg.classList.add('hidden');
            } else {
                els.btnGenerate.disabled = true;
                els.btnGenerate.classList.add('bg-gray-600', 'cursor-not-allowed', 'text-gray-400', 'border-gray-600');
                els.btnGenerate.classList.remove('bg-blue-600', 'hover:bg-blue-500', 'cursor-pointer', 'text-white', 'border-blue-600', 'shadow-blue-900/50');
            }
        }

        function selectTarget(key) {
            state.targetKey = key;
            state.patternId = ""; // Reset pattern when target changes
            
            // UI Update for Target Buttons
            document.querySelectorAll('.target-btn').forEach(btn => {
                if(btn.dataset.val === key) {
                    btn.classList.add('bg-blue-900', 'border-blue-500', 'ring-2', 'ring-blue-500', 'ring-offset-2', 'ring-offset-gray-800');
                    btn.classList.remove('bg-gray-700', 'border-gray-600');
                } else {
                    btn.classList.remove('bg-blue-900', 'border-blue-500', 'ring-2', 'ring-blue-500', 'ring-offset-2', 'ring-offset-gray-800');
                    btn.classList.add('bg-gray-700', 'border-gray-600');
                }
            });

            renderPatterns(key);
            els.designSection.classList.remove('hidden');
            checkValidity();
        }

        function renderPatterns(targetKey) {
            const data = designMatrix[targetKey];
            els.designContainer.innerHTML = '';

            data.patterns.forEach(p => {
                const btn = document.createElement('button');
                btn.className = 'design-btn relative flex flex-col items-start p-4 border rounded-xl hover:shadow-lg transition w-full text-left bg-gray-700 border-gray-600';
                btn.onclick = () => selectPattern(p.id, btn);
                
                // Color Preview Circles
                const colorDots = p.colors.map(c => 
                    `<span class="w-6 h-6 rounded-full border border-gray-600 shadow-sm" style="background-color: ${c};"></span>`
                ).join('');

                btn.innerHTML = `
                    <div class="flex gap-2 mb-3">${colorDots}</div>
                    <div class="font-bold text-gray-200 text-sm mb-1 line-clamp-1">${p.name}</div>
                    <div class="text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded border border-gray-600 w-full truncate">${p.desc}</div>
                `;
                els.designContainer.appendChild(btn);
            });
        }

        function selectPattern(id, btnElement) {
            state.patternId = id;
            
            // UI reset
            document.querySelectorAll('.design-btn').forEach(b => {
                b.classList.remove('ring-2', 'ring-blue-500', 'border-blue-500', 'bg-blue-900', 'ring-offset-2', 'ring-offset-gray-800');
                b.classList.add('bg-gray-700', 'border-gray-600');
            });
            // Active state
            btnElement.classList.remove('bg-gray-700', 'border-gray-600');
            btnElement.classList.add('ring-2', 'ring-blue-500', 'border-blue-500', 'bg-blue-900', 'ring-offset-2', 'ring-offset-gray-800');
            
            checkValidity();
        }

        // --- Flow Control ---

        function updateStepper(isOutputPhase) {
            // Step 1: Settings
            const div0 = els.step0.querySelector('div');
            const span0 = els.step0.querySelector('span');
            div0.className = 'w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold step-active transition-colors shadow-lg';
            span0.className = 'text-xs mt-2 font-bold text-blue-400';

            // Step 2: Output
            const divOut = els.stepOutput.querySelector('div');
            const spanOut = els.stepOutput.querySelector('span');
            
            if(isOutputPhase) {
                divOut.classList.remove('step-inactive');
                divOut.classList.add('step-active');
                spanOut.className = 'text-xs mt-2 font-bold text-blue-400';
            } else {
                divOut.classList.add('step-inactive');
                divOut.classList.remove('step-active');
                spanOut.className = 'text-xs mt-2 font-bold text-gray-500';
            }
        }

        function generateAndGoToOutput() {
            if(els.btnGenerate.disabled) return;

            generatePromptScript();

            els.phase0.classList.add('hidden');
            els.phase2.classList.remove('hidden');
            els.phaseIndicator.textContent = "å‡ºåŠ›";
            updateStepper(true);
            window.scrollTo(0,0);
        }

        function backToPhase0() {
            els.phase2.classList.add('hidden');
            els.phase0.classList.remove('hidden');
            els.phaseIndicator.textContent = "è¦ä»¶å®šç¾©";
            updateStepper(false);
        }

        // --- Prompt Generation Logic ---

        function generatePromptScript() {
            const targetData = designMatrix[state.targetKey];
            const patternData = targetData.patterns.find(p => p.id === state.patternId);
            
            // AIã¸ã®æŒ‡ç¤ºæ›¸ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã‚’ä½œæˆ
            // ä½™è¨ˆãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šé™¤ã—ã€ç´”ç²‹ãªè¦ä»¶å®šç¾©ã®ã¿ã‚’å‡ºåŠ›ã™ã‚‹
            let script = ``;
            
            script += `# å…¥åŠ›æƒ…å ± (è¦ä»¶å®šç¾©)\n`;
            script += `- **ãƒ†ãƒ¼ãƒ:** ${state.theme}\n`;
            script += `- **å¯¾è±¡èª­è€…:** ${targetData.name}\n`;
            script += `- **é¸æŠã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³:** ${patternData.name} - ${patternData.desc}\n`;
            script += `- **ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ (HEX):** ${patternData.colors.join(', ')}\n`;
            if (state.udFont) {
                script += `- **UDãƒ•ã‚©ãƒ³ãƒˆ:** ä½¿ç”¨ã™ã‚‹ (BIZ UDPã‚´ã‚·ãƒƒã‚¯)\n`;
            } else {
                script += `- **UDãƒ•ã‚©ãƒ³ãƒˆ:** æŒ‡å®šãªã—\n`;
            }
            script += `\n`;

            script += `# ãƒ‡ã‚¶ã‚¤ãƒ³/ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¦ä»¶\n`;
            script += `1. **è¨€è‘‰é£ã„ã¨ãƒˆãƒ¼ãƒ³:** ${targetData.name}ã«åˆã‚ã›ã¦æœ€é©åŒ–ã—ã¦ãã ã•ã„ã€‚\n`;
            script += `   (ä¾‹: å°å­¦ç”Ÿãªã‚‰å¹³æ˜“ãªè¨€è‘‰ã¨ã€Œã§ã™ãƒ»ã¾ã™ã€ã€æ•™å“¡ãªã‚‰å…¬å¼æ–‡æ›¸çš„ãªãƒˆãƒ¼ãƒ³)\n`;
            script += `2. **é…è‰²:** æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ (${patternData.colors.join(', ')}) ã‚’å¿…ãšä½¿ç”¨ã—ã€ã‚¹ãƒ©ã‚¤ãƒ‰ã®èƒŒæ™¯è‰²ã€ãƒ†ã‚­ã‚¹ãƒˆè‰²ã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ã«é©ç”¨ã—ã¦ãã ã•ã„ã€‚\n`;
            
            if (state.udFont) {
                script += `3. **ãƒ•ã‚©ãƒ³ãƒˆ:** ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã«é…æ…®ã—ã€å¿…ãš **ã€ŒBIZ UDPã‚´ã‚·ãƒƒã‚¯ã€** ("BIZ UDPGothic") ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚`;
            } else {
                script += `3. **ãƒ•ã‚©ãƒ³ãƒˆ:** æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆï¼ˆ"Sawarabi Mincho", "M PLUS 1p" ç­‰ï¼‰ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ã€æ–‡å­—åŒ–ã‘ã‚’é˜²ã„ã§ãã ã•ã„ã€‚`;
            }

            els.finalCode.textContent = script;
        }

        function copyToClipboard() {
            const text = els.finalCode.textContent;
            
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            
            textarea.select();
            
            try {
                document.execCommand('copy');
                const btn = document.querySelector('button[onclick="copyToClipboard()"]');
                const originalHtml = btn.innerHTML;
                const originalClasses = btn.className;

                btn.innerHTML = '<i class="fas fa-check mr-1"></i> Copied!';
                // Switch to success gradient
                btn.className = "bg-gradient-to-r from-green-500 to-emerald-600 text-white text-base px-8 py-3 rounded-lg shadow-xl transition flex items-center gap-2 font-extrabold transform scale-105 border border-white/20";
                
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.className = originalClasses;
                }, 2000);
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            
            document.body.removeChild(textarea);
        }

    </script>
</body>
</html>
