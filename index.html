<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Googleã‚¹ãƒ©ã‚¤ãƒ‰è¨­è¨ˆã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=BIZ+UDPGothic:wght@400;700&family=Noto+Sans+JP:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #111827; /* Dark Mode Bg */
            color: #f3f4f6;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }

        .code-block {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            background-color: #000000;
            color: #4ade80; /* Matrix green text */
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            white-space: pre;
            font-size: 0.875rem;
            line-height: 1.5;
            border: 1px solid #374151;
        }

        .step-active {
            background-color: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }
        
        .step-inactive {
            background-color: #374151;
            border-color: #4b5563;
            color: #9ca3af;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Input autofill fix for dark mode */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active{
            -webkit-box-shadow: 0 0 0 30px #374151 inset !important;
            -webkit-text-fill-color: white !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-gray-800 shadow-lg sticky top-0 z-50 border-b border-gray-700">
        <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 text-white p-2 rounded-lg shadow-blue-500/50 shadow-md">
                    <!-- Icon changed to pen-ruler for "Design/Create" feel -->
                    <i class="fas fa-pen-ruler text-xl"></i>
                </div>
                <div>
                    <!-- Updated Title & Subtitle (Option A) -->
                    <h1 class="text-xl font-bold text-gray-100">Googleã‚¹ãƒ©ã‚¤ãƒ‰è¨­è¨ˆã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼</h1>
                    <p class="text-xs text-gray-400">Geminiã§ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãŸã‚ã®æŒ‡ç¤ºæ›¸ä½œæˆãƒ„ãƒ¼ãƒ«</p>
                </div>
            </div>
            <div class="text-sm font-medium text-blue-400" id="phase-indicator">
                ã‚¹ãƒ©ã‚¤ãƒ‰ã®åŸºæœ¬è¨­å®š
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-4xl mx-auto w-full px-4 py-8">
        
        <!-- Progress Steps -->
        <div class="flex justify-between mb-10 relative px-10">
            <div class="absolute top-1/2 left-0 w-full h-0.5 bg-gray-700 -z-10 transform -translate-y-1/2"></div>
            
            <!-- Step 1: è¨­å®š -->
            <div id="step-0" class="flex flex-col items-center bg-gray-800 px-4 rounded-full z-10">
                <div class="w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold step-active transition-colors shadow-lg">1</div>
                <span class="text-xs mt-2 font-bold text-blue-400">åŸºæœ¬è¨­å®š</span>
            </div>
            
            <!-- Step 2: å‡ºåŠ› -->
            <div id="step-output" class="flex flex-col items-center bg-gray-800 px-4 rounded-full z-10">
                <div class="w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold step-inactive transition-colors shadow-lg">2</div>
                <span class="text-xs mt-2 font-bold text-gray-500">å‡ºåŠ›</span>
            </div>
        </div>

        <!-- PHASE 0: Input Form -->
        <section id="phase-0" class="bg-gray-800 rounded-xl shadow-xl p-6 md:p-8 animate-fade-in border border-gray-700">
            <h2 class="text-2xl font-bold text-gray-100 mb-6 border-b border-gray-700 pb-4 flex items-center">
                <i class="fas fa-sliders-h text-blue-500 mr-3"></i>ä½œã‚ŠãŸã„ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’æ•™ãˆã¦ãã ã•ã„
            </h2>
            
            <!-- 1. Theme -->
            <div class="mb-10">
                <div class="flex items-baseline gap-2 mb-2">
                    <label class="block text-sm font-bold text-gray-300">â‘  ãƒ†ãƒ¼ãƒ</label>
                    <span class="text-xs text-gray-400">â€»ã–ã£ãã‚Šã—ãŸå†…å®¹ã§ã‚‚ç´°ã‹ã„ã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆã‚’å…¥ã‚Œã¦ã‚‚OK</span>
                </div>
                <textarea id="input-theme" placeholder="ä¾‹ï¼‘ï¼šä¿®å­¦æ—…è¡Œã®èª¬æ˜ã€å…‰åˆæˆã®ä»•çµ„ã¿ã€é€²è·¯é¸æŠã«ã¤ã„ã¦&#10;ä¾‹ï¼’ï¼šã‚¹ãƒ©ã‚¤ãƒ‰ï¼‘ï¼šã‚¿ã‚¤ãƒˆãƒ«ãƒ»ãƒ»ãƒ»ã€€ï½ã€€ã€€ã‚¹ãƒ©ã‚¤ãƒ‰ï¼‘ï¼ï¼šã¾ã¨ã‚" 
                    class="w-full p-4 h-32 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition text-lg shadow-inner resize-y"></textarea>
            </div>

            <!-- 2. Target Audience -->
            <div class="mb-10">
                <label class="block text-sm font-bold text-gray-300 mb-4">â‘¡ å¯¾è±¡</label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <button onclick="selectTarget('elementary')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="elementary">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ’</span>
                        <span class="text-sm font-bold text-gray-200">å°å­¦éƒ¨</span>
                    </button>
                    <button onclick="selectTarget('middle')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="middle">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ«</span>
                        <span class="text-sm font-bold text-gray-200">ä¸­å­¦éƒ¨</span>
                    </button>
                    <button onclick="selectTarget('high')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="high">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ“</span>
                        <span class="text-sm font-bold text-gray-200">é«˜ç­‰éƒ¨</span>
                    </button>
                    <button onclick="selectTarget('teachers')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="teachers">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ‘©â€ğŸ«</span>
                        <span class="text-sm font-bold text-gray-200">æ•™å“¡å‘ã‘</span>
                    </button>
                    <button onclick="selectTarget('parents')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="parents">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                        <span class="text-sm font-bold text-gray-200">ä¿è­·è€…å‘ã‘</span>
                    </button>
                    <button onclick="selectTarget('universal')" class="target-btn p-4 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-blue-500 text-left transition group" data-val="universal">
                        <span class="block text-2xl mb-1 group-hover:scale-110 transition-transform">ğŸ‘ï¸</span>
                        <span class="text-sm font-bold text-gray-200">ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«</span>
                    </button>
                </div>
            </div>

            <!-- 3. Design Selection (Hidden until Target is selected) -->
            <div id="design-section" class="mb-10 hidden animate-fade-in">
                <label class="block text-sm font-bold text-gray-300 mb-4">â‘¢ ãƒ‡ã‚¶ã‚¤ãƒ³ - 12ç¨®é¡ã‹ã‚‰é¸æŠ</label>
                <div id="design-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <!-- Javascript will populate this -->
                </div>
                
                <!-- 4. Option (UD Font) -->
                <div class="pt-6 border-t border-gray-700">
                    <label class="block text-sm font-bold text-gray-300 mb-4">â‘£ ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
                    <label class="flex items-center gap-4 p-4 bg-gray-700 border border-gray-600 rounded-lg cursor-pointer hover:bg-gray-600 transition group">
                        <!-- Checked by default -->
                        <input type="checkbox" id="input-udfont" class="w-6 h-6 text-blue-600 rounded bg-gray-800 border-gray-500 focus:ring-blue-500 focus:ring-offset-gray-800" checked>
                        <div>
                            <span class="block text-base font-bold text-gray-200 group-hover:text-white">UDãƒ•ã‚©ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹</span>
                            <span class="block text-xs text-gray-400 mt-1">ã€ŒBIZ UDPã‚´ã‚·ãƒƒã‚¯ã€ã‚’æŒ‡å®šã—ã€èª­ã¿ã‚„ã™ã•ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Action -->
            <div class="text-center pt-8">
                <button onclick="generateAndGoToOutput()" id="btn-generate-proposal" disabled 
                    class="bg-gray-600 text-gray-400 font-bold py-4 px-12 rounded-full shadow-lg cursor-not-allowed transition-all transform text-lg border border-gray-600 w-full md:w-auto hover:shadow-blue-900/50">
                    <i class="fas fa-magic mr-2"></i>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆã™ã‚‹
                </button>
                <p id="error-msg" class="text-red-400 text-sm mt-3 hidden bg-red-900/30 py-2 rounded border border-red-900/50 inline-block px-4">å…¨ã¦ã®é …ç›®ï¼ˆãƒ†ãƒ¼ãƒãƒ»å¯¾è±¡ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            </div>
        </section>


        <!-- PHASE 2: Final Output -->
        <section id="phase-2" class="hidden animate-fade-in">
            <div class="bg-gray-800 rounded-xl shadow-xl p-6 md:p-8 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-100 flex items-center gap-3">
                        <div class="bg-green-500/20 p-2 rounded-lg">
                            <i class="fas fa-check text-green-500"></i>
                        </div>
                        AIæŒ‡ç¤ºæ›¸ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã®ç”Ÿæˆå®Œäº†
                    </h2>
                    <button onclick="backToPhase0()" class="text-sm text-gray-400 hover:text-blue-400 underline transition">
                        è¦ä»¶ã‚’ä¿®æ­£ã™ã‚‹
                    </button>
                </div>
                
                <p class="text-gray-400 mb-6 text-sm leading-relaxed">
                    ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ã€GEMï¼ˆAIï¼‰ã«å¯¾ã™ã‚‹<strong>ã€Œã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆæŒ‡ç¤ºæ›¸ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã€</strong>ã§ã™ã€‚<br>
                    ã“ã‚Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦GEMã«æ¸¡ã™ã¨ã€AIãŒæŒ‡ç¤ºå†…å®¹ã‚’å®Œå…¨ã«ç†è§£ã—ã€æœ€é©ãªGoogleã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
                </p>

                <!-- Actions Toolbar -->
                <div class="flex flex-wrap items-center justify-end gap-4 mb-4">
                    <button onclick="copyToClipboard()" class="bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-500 hover:to-cyan-400 text-white text-base px-8 py-3 rounded-lg shadow-xl transition flex items-center gap-2 font-extrabold transform hover:scale-105 border border-white/20">
                        <i class="fas fa-copy"></i> â‘ ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
                    </button>
                    <a href="https://gemini.google.com/gem/1IyiaDM91R8aOpYBN3-Svgprwd5bC37uQ?usp=sharing" target="_blank" rel="noopener noreferrer" 
                       class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 hover:from-indigo-500 hover:via-purple-500 hover:to-pink-500 text-white text-base px-8 py-3 rounded-lg shadow-xl transition flex items-center gap-2 font-extrabold no-underline transform hover:scale-105 border border-white/20">
                        <i class="fas fa-sparkles"></i> â‘¡NEW Chat
                    </a>
                </div>

                <div class="relative group">
                    <pre id="final-code" class="code-block h-96 overflow-y-auto custom-scrollbar shadow-inner"></pre>
                </div>

                <div class="mt-10 text-center">
            <button onclick="location.reload()" class="px-8 py-3 text-blue-400 font-bold hover:bg-blue-900/30 hover:text-blue-300 rounded-lg transition border border-transparent hover:border-blue-900">
                <i class="fas fa-redo mr-2"></i>æ–°ã—ã„ãƒ†ãƒ¼ãƒã§ä½œæˆã™ã‚‹
            </button>
        </div>
    </div>
</section>

</main>

<footer class="bg-gray-800 border-t border-gray-700 mt-auto py-8">
<div class="max-w-5xl mx-auto px-4 text-center text-gray-500 text-xs">
    <p class="mb-2 font-bold text-gray-400">EduSlide Architect</p>
    <p>&copy; 2025 Education Slide Architect / Based on GEM Custom Instructions</p>
</div>
</footer>

<!-- JavaScript Application Logic -->
<script>
// --- Data Definitions (Target x Design Matrix: Expanded to 12 - High Visibility Version) ---
const designMatrix = {
    elementary: {
        name: "å°å­¦éƒ¨å‘ã‘ (Elementary)",
        patterns: [
            { id: "A", name: "ã€å…ƒæ°—ãƒ»ãƒãƒƒãƒ—ã€‘", colors: ["#FFFFFF", "#0277BD", "#E65100"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã„é’ã¨ã‚ªãƒ¬ãƒ³ã‚¸" },
            { id: "B", name: "ã€é’ç©ºãƒ»å¤ªé™½ã€‘", colors: ["#E1F5FE", "#01579B", "#D32F2F"], desc: "æ·¡é’èƒŒæ™¯ã«ãã£ãã‚Šèµ¤é’" },
            { id: "C", name: "ã€æ£®ã®æ¢æ¤œã€‘", colors: ["#F1F8E9", "#1B5E20", "#4E342E"], desc: "æ·¡ç·‘èƒŒæ™¯ã«æ¿ƒç·‘ã¨æ¿ƒèŒ¶" },
            { id: "D", name: "ã€ãã£ãã‚Šãƒ»çµµæœ¬ã€‘", colors: ["#FFFFFF", "#212121", "#D50000"], desc: "ç™½èƒŒæ™¯ã«é»’æ–‡å­—ã¨é®®çƒˆãªèµ¤" },
            { id: "E", name: "ã€æ˜Ÿç©ºãƒ»å®‡å®™ã€‘", colors: ["#1A237E", "#FFFFFF", "#FFD600"], desc: "æ¿ƒç´ºèƒŒæ™¯ã«ç™½æ–‡å­—ã¨é»„è‰²" },
            { id: "F", name: "ã€ã‚¹ãƒˆãƒ­ãƒ™ãƒªãƒ¼ã€‘", colors: ["#FFFFFF", "#C2185B", "#1B5E20"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒãƒ”ãƒ³ã‚¯ã¨æ¿ƒç·‘" },
            { id: "G", name: "ã€æµ·ãƒ»ãƒãƒªãƒ³ã€‘", colors: ["#FFFFFF", "#0D47A1", "#0288D1"], desc: "ç™½èƒŒæ™¯ã«2ç¨®ã®æ¿ƒã„é’" },
            { id: "H", name: "ã€ãƒ’ãƒãƒ¯ãƒªã€‘", colors: ["#FFFDE7", "#212121", "#F57F17"], desc: "æ·¡é»„èƒŒæ™¯ã«é»’ã¨æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸" },
            { id: "I", name: "ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã€‘", colors: ["#FFFFFF", "#212121", "#E65100"], desc: "ç™½èƒŒæ™¯ã«é»’ã¨ç›®ç«‹ã¤ã‚ªãƒ¬ãƒ³ã‚¸" },
            { id: "J", name: "ã€ã‚µãƒ•ã‚¡ãƒªã€‘", colors: ["#EFEBE9", "#3E2723", "#1B5E20"], desc: "æ·¡èŒ¶èƒŒæ™¯ã«æ¿ƒèŒ¶ã¨æ¿ƒç·‘" },
            { id: "K", name: "ã€ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ã€‘", colors: ["#FFFFFF", "#0D47A1", "#B71C1C"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã„é’ã¨æ¿ƒã„èµ¤" },
            { id: "L", name: "ã€é»’æ¿ãƒ»ãƒãƒ§ãƒ¼ã‚¯ã€‘", colors: ["#263238", "#FFFFFF", "#FFEB3B"], desc: "é»’æ¿è‰²ã«ç™½ã¨é»„è‰²ã®æ–‡å­—" }
        ]
    },
    middle: {
        name: "ä¸­å­¦éƒ¨å‘ã‘ (Middle School)",
        patterns: [
            { id: "A", name: "ã€å­¦æ ¡ãƒ»é»’æ¿ã€‘", colors: ["#1B5E20", "#FFFFFF", "#FFEB3B"], desc: "ç·‘ã®é»’æ¿ã«ç™½ã¨é»„è‰²ã®æ–‡å­—" },
            { id: "B", name: "ã€ã‚¹ãƒãƒ¼ãƒˆãƒãƒ¼ãƒˆã€‘", colors: ["#FFFFFF", "#1A237E", "#D32F2F"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒç´ºã¨æ¿ƒèµ¤" },
            { id: "C", name: "ã€éƒ¨æ´»ãƒ»ã‚¨ãƒŠã‚¸ãƒ¼ã€‘", colors: ["#FFFFFF", "#E65100", "#212121"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã‚ªãƒ¬ãƒ³ã‚¸ã¨é»’" },
            { id: "D", name: "ã€ãƒ†ãƒƒã‚¯ãƒ»ãƒ€ãƒ¼ã‚¯ã€‘", colors: ["#212121", "#FFFFFF", "#00E676"], desc: "é»’èƒŒæ™¯ã«ç™½ã¨ãƒã‚ªãƒ³ã‚°ãƒªãƒ¼ãƒ³" },
            { id: "E", name: "ã€ã‚¯ãƒªã‚¢ãƒ»ãƒ–ãƒ«ãƒ¼ã€‘", colors: ["#E3F2FD", "#0D47A1", "#1565C0"], desc: "æ·¡é’èƒŒæ™¯ã«é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆé’" },
            { id: "F", name: "ã€ãƒ¢ãƒã‚¯ãƒ­ã‚·ãƒ£ãƒ¼ãƒ—ã€‘", colors: ["#FFFFFF", "#000000", "#757575"], desc: "ç™½é»’ç°ã§è¦–èªæ€§æœ€å¤§" },
            { id: "G", name: "ã€ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã€‘", colors: ["#FFFFFF", "#006064", "#00BCD4"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã„é’ç·‘" },
            { id: "H", name: "ã€ãƒ’ã‚¹ãƒˆãƒªãƒ¼ã€‘", colors: ["#FFF8E1", "#3E2723", "#5D4037"], desc: "æ·¡é»„èƒŒæ™¯ã«æ¿ƒã„èŒ¶è‰²" },
            { id: "I", name: "ã€ãƒã‚¤ãƒ“ãƒ¼ã‚¤ã‚¨ãƒ­ãƒ¼ã€‘", colors: ["#0D47A1", "#FFFFFF", "#FFD600"], desc: "æ¿ƒç´ºèƒŒæ™¯ã«ç™½ã¨é»„è‰²" },
            { id: "J", name: "ã€ã‚¢ãƒ¼ãƒãƒ³ãƒ»ã‚·ãƒ†ã‚£ã€‘", colors: ["#ECEFF1", "#263238", "#455A64"], desc: "è–„ç°èƒŒæ™¯ã«æ¿ƒç°æ–‡å­—" },
            { id: "K", name: "ã€ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ç·‘ã€‘", colors: ["#FFFFFF", "#1B5E20", "#4CAF50"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒç·‘ã¨é®®ã‚„ã‹ãªç·‘" },
            { id: "L", name: "ã€ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ‘ãƒ¼ãƒ—ãƒ«ã€‘", colors: ["#311B92", "#FFFFFF", "#EA80FC"], desc: "æ¿ƒç´«èƒŒæ™¯ã«ç™½ã¨æ˜ã‚‹ã„ç´«" }
        ]
    },
    high: {
        name: "é«˜ç­‰éƒ¨å‘ã‘ (High School)",
        patterns: [
            { id: "A", name: "ã€ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯ã€‘", colors: ["#FFFFFF", "#0D47A1", "#1A237E"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã„é’ã¨ç´º" },
            { id: "B", name: "ã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯é»’ã€‘", colors: ["#FFFFFF", "#212121", "#000000"], desc: "ç™½èƒŒæ™¯ã«çœŸã£é»’ãªæ–‡å­—" },
            { id: "C", name: "ã€ãƒ¢ãƒ€ãƒ³ãƒ»ãƒ€ãƒ¼ã‚¯ã€‘", colors: ["#121212", "#FFFFFF", "#90CAF9"], desc: "æ¼†é»’ã«ç™½æ–‡å­—ã¨æ·¡ã„é’" },
            { id: "D", name: "ã€ã‚¯ãƒªãƒ ã‚¾ãƒ³èµ¤ã€‘", colors: ["#FFFFFF", "#B71C1C", "#212121"], desc: "ç™½èƒŒæ™¯ã«ãˆã‚“ã˜è‰²ã¨é»’" },
            { id: "E", name: "ã€ãƒŸãƒ‹ãƒãƒ«ãƒ»ç™½ã€‘", colors: ["#FAFAFA", "#424242", "#1976D2"], desc: "çœŸã£ç™½ãªèƒŒæ™¯ã«æ¿ƒç°ã¨é’" },
            { id: "F", name: "ã€ã‚¨ã‚³ãƒ»ã‚°ãƒªãƒ¼ãƒ³ã€‘", colors: ["#FFFFFF", "#004D40", "#00695C"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã„é’ç·‘" },
            { id: "G", name: "ã€ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã€‘", colors: ["#000000", "#FFFFFF", "#00B0FF"], desc: "é»’èƒŒæ™¯ã«ç™½ã¨æ˜ã‚‹ã„ã‚·ã‚¢ãƒ³" },
            { id: "H", name: "ã€ãƒˆãƒ©ãƒ‡ã‚£ã‚·ãƒ§ãƒŠãƒ«ã€‘", colors: ["#FFFFFF", "#3E2723", "#5D4037"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã„èŒ¶è‰²" },
            { id: "I", name: "ã€ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã€‘", colors: ["#FFFFFF", "#311B92", "#6200EA"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã„ç´«ã¨é’ç´«" },
            { id: "J", name: "ã€ãƒã‚¤ã‚³ãƒ³é»„é»’ã€‘", colors: ["#000000", "#FFD600", "#FFFFFF"], desc: "é»’èƒŒæ™¯ã«é»„è‰²ã¨ç™½ã®æ–‡å­—" },
            { id: "K", name: "ã€ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆç´ºã€‘", colors: ["#F5F5F5", "#1A237E", "#B71C1C"], desc: "æ·¡ç°ã«æ¿ƒç´ºã¨ãˆã‚“ã˜è‰²" },
            { id: "L", name: "ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã€‘", colors: ["#FFFFFF", "#01579B", "#33691E"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã„é’ã¨æ¿ƒã„ç·‘" }
        ]
    },
    teachers: {
        name: "æ•™å“¡å‘ã‘ (For Teachers)",
        patterns: [
            { id: "A", name: "ã€ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã€‘", colors: ["#FFFFFF", "#212121", "#0277BD"], desc: "ç™½èƒŒæ™¯ã«é»’ã¨å…¬å¼ãªé’" },
            { id: "B", name: "ã€ãƒ—ãƒªãƒ³ãƒˆç”¨ç™½é»’ã€‘", colors: ["#FFFFFF", "#000000", "#757575"], desc: "ç™½é»’å°åˆ·ã«æœ€é©ãªé«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ" },
            { id: "C", name: "ã€ãƒˆãƒ©ã‚¹ãƒˆãƒ»ç´ºã€‘", colors: ["#FFFFFF", "#0D47A1", "#1565C0"], desc: "ç™½èƒŒæ™¯ã«ä¿¡é ¼æ„Ÿã®ã‚ã‚‹æ¿ƒç´º" },
            { id: "D", name: "ã€ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã€‘", colors: ["#FFFFFF", "#E65100", "#212121"], desc: "ç™½èƒŒæ™¯ã«ç›®ç«‹ã¤ã‚ªãƒ¬ãƒ³ã‚¸ã¨é»’" },
            { id: "E", name: "ã€ç ”ä¿®ã‚°ãƒªãƒ¼ãƒ³ã€‘", colors: ["#FFFFFF", "#1B5E20", "#2E7D32"], desc: "ç™½èƒŒæ™¯ã«è½ã¡ç€ã„ãŸæ¿ƒç·‘" },
            { id: "F", name: "ã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æš—ã€‘", colors: ["#263238", "#FFFFFF", "#4FC3F7"], desc: "æ¿ƒç°èƒŒæ™¯ã«ç™½ã¨æ°´è‰²" },
            { id: "G", name: "ã€ãƒ­ã‚¸ã‚«ãƒ«ãƒ–ãƒ«ãƒ¼ã€‘", colors: ["#F3F6F9", "#003366", "#CC0000"], desc: "ã”ãæ·¡ã„é’ã«æ¿ƒç´ºã¨æ¿ƒèµ¤" },
            { id: "H", name: "ã€æ¸©ã‚‚ã‚Šãƒ–ãƒ©ã‚¦ãƒ³ã€‘", colors: ["#FFFFFF", "#4E342E", "#3E2723"], desc: "ç™½èƒŒæ™¯ã«è½ã¡ç€ã„ãŸæ¿ƒèŒ¶" },
            { id: "I", name: "ã€ã‚¯ãƒªã‚¢ãƒ›ãƒ¯ã‚¤ãƒˆã€‘", colors: ["#FFFFFF", "#333333", "#005AFF"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒç°ã¨é®®æ˜ãªé’" },
            { id: "J", name: "ã€ãƒ‡ãƒ¼ã‚¿ãƒ¬ãƒãƒ¼ãƒˆã€‘", colors: ["#FFFFFF", "#4A148C", "#212121"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒç´«ã¨é»’" },
            { id: "K", name: "ã€ã‚·ãƒ³ãƒ—ãƒ«ã‚»ãƒ”ã‚¢ã€‘", colors: ["#FEFBEA", "#212121", "#5D4037"], desc: "æ·¡ã‚¢ã‚¤ãƒœãƒªãƒ¼ã«é»’ã¨æ¿ƒèŒ¶" },
            { id: "L", name: "ã€ãƒã‚¤ã‚³ãƒ³é»„è‰²ã€‘", colors: ["#212121", "#FFFFFF", "#FFD600"], desc: "æ¿ƒç°èƒŒæ™¯ã«ç™½ã¨é»„è‰²" }
        ]
    },
    parents: {
        name: "ä¿è­·è€…å‘ã‘ (For Parents)",
        patterns: [
            { id: "A", name: "ã€èª å®Ÿãƒ»ãƒã‚¤ãƒ“ãƒ¼ã€‘", colors: ["#FFFFFF", "#0D47A1", "#212121"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒç´ºã¨é»’" },
            { id: "B", name: "ã€æ¸©ã‚‚ã‚Šãƒ–ãƒ©ã‚¦ãƒ³ã€‘", colors: ["#FFFFFF", "#3E2723", "#5D4037"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒãè½ã¡ç€ã„ãŸèŒ¶è‰²" },
            { id: "C", name: "ã€å®‰å¿ƒãƒ»ã‚°ãƒªãƒ¼ãƒ³ã€‘", colors: ["#FFFFFF", "#1B5E20", "#212121"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒç·‘ã¨é»’" },
            { id: "D", name: "ã€ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆç´«ã€‘", colors: ["#FFFFFF", "#4A148C", "#212121"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒç´«ã¨é»’" },
            { id: "E", name: "ã€æ˜ã‚‹ã„ã‚ªãƒ¬ãƒ³ã‚¸ã€‘", colors: ["#FFFFFF", "#E65100", "#212121"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã‚ªãƒ¬ãƒ³ã‚¸ã¨é»’" },
            { id: "F", name: "ã€ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ç©ºè‰²ã€‘", colors: ["#F0F8FF", "#01579B", "#212121"], desc: "æ·¡é’èƒŒæ™¯ã«æ¿ƒé’ã¨é»’" },
            { id: "G", name: "ã€å’Œé¢¨ãƒ»ãˆã‚“ã˜ã€‘", colors: ["#FFFFFF", "#880E4F", "#212121"], desc: "ç™½èƒŒæ™¯ã«æ¿ƒã„èµ¤ç´«ã¨é»’" },
            { id: "H", name: "ã€è¦ªã—ã¿ã‚¤ã‚¨ãƒ­ãƒ¼ã€‘", colors: ["#FFFDE7", "#212121", "#F57F17"], desc: "æ·¡é»„èƒŒæ™¯ã«é»’ã¨æ¿ƒé»„" },
            { id: "I", name: "ã€ã‚½ãƒ•ãƒˆãƒ€ãƒ¼ã‚¯ã€‘", colors: ["#37474F", "#FFFFFF", "#81D4FA"], desc: "æ¿ƒç°èƒŒæ™¯ã«ç™½ã¨æ·¡é’" },
            { id: "J", name: "ã€ãƒŠãƒãƒ¥ãƒ©ãƒ«ã€‘", colors: ["#F5F5DC", "#212121", "#3E2723"], desc: "ãƒ™ãƒ¼ã‚¸ãƒ¥ã«é»’ã¨æ¿ƒèŒ¶" },
            { id: "K", name: "ã€ã‚¯ãƒªã‚¢ãƒ¢ãƒã‚¯ãƒ­ã€‘", colors: ["#FFFFFF", "#000000", "#616161"], desc: "ç™½èƒŒæ™¯ã«é»’ã¨æ¿ƒç°" },
            { id: "L", name: "ã€ãƒ•ã‚©ãƒ¼ãƒãƒ«é»’ã€‘", colors: ["#FAFAFA", "#212121", "#0D47A1"], desc: "ç™½èƒŒæ™¯ã«é»’ã¨æ¿ƒç´º" }
        ]
    },
    universal: {
        name: "ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ« (Universal)",
        patterns: [
            { id: "A", name: "ã€UDç™½èƒŒæ™¯ãƒ»é’é»’ã€‘", colors: ["#FFFFFF", "#000000", "#005AFF"], desc: "æœ€å¤§è¦–èªæ€§ï¼ˆç™½åœ°ã«é»’ãƒ»é’ï¼‰" },
            { id: "B", name: "ã€UDé»’èƒŒæ™¯ãƒ»é»„ç™½ã€‘", colors: ["#000000", "#FFFFFF", "#FFD600"], desc: "ç›®ã¸ã®è² æ‹…æ¸›ï¼ˆé»’åœ°ã«ç™½ãƒ»é»„ï¼‰" },
            { id: "C", name: "ã€UDç™½èƒŒæ™¯ãƒ»æœ±é»’ã€‘", colors: ["#FFFFFF", "#000000", "#FF5722"], desc: "è‰²è¦šãƒãƒªã‚¢ãƒ•ãƒªãƒ¼ï¼ˆç™½åœ°ã«é»’ãƒ»æœ±ï¼‰" },
            { id: "D", name: "ã€UDé»’èƒŒæ™¯ãƒ»ç·‘ç™½ã€‘", colors: ["#000000", "#FFFFFF", "#00E676"], desc: "é»’èƒŒæ™¯ã«ç™½ã¨æ˜ã‚‹ã„ç·‘" },
            { id: "E", name: "ã€CUDæ¨å¥¨ãƒ»é’é»„ã€‘", colors: ["#005AFF", "#FFD600", "#FFFFFF"], desc: "CUDæ¨å¥¨é…è‰²ï¼ˆé’èƒŒæ™¯ã«é»„ãƒ»ç™½ï¼‰" },
            { id: "F", name: "ã€CUDæ¨å¥¨ãƒ»èµ¤é»’ã€‘", colors: ["#FFFFFF", "#000000", "#D32027"], desc: "ç™½èƒŒæ™¯ã«é»’ã¨ãã£ãã‚Šã—ãŸèµ¤" },
            { id: "G", name: "ã€ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ã€‘", colors: ["#FFFFFF", "#000000", "#757575"], desc: "è‰²æƒ…å ±ã«ä¾å­˜ã—ãªã„å®Œå…¨ç™½é»’ç°" },
            { id: "H", name: "ã€ãƒ­ãƒ¼ã‚³ãƒ³ç™½é…æ…®ã€‘", colors: ["#FAFAFA", "#212121", "#424242"], desc: "å…‰éæ•é…æ…®ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆè»½æ¸›(ç™½)" },
            { id: "I", name: "ã€ãƒ­ãƒ¼ã‚³ãƒ³é»’é…æ…®ã€‘", colors: ["#212121", "#E0E0E0", "#BDBDBD"], desc: "å…‰éæ•é…æ…®ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆè»½æ¸›(é»’)" },
            { id: "J", name: "ã€ã‚»ãƒ”ã‚¢ãƒ»ä½ãƒ–ãƒ«ãƒ¼ã€‘", colors: ["#F4ECD8", "#3E2723", "#5D4037"], desc: "ãƒ–ãƒ«ãƒ¼ãƒ©ã‚¤ãƒˆã‚’æŠ‘ãˆãŸé…è‰²" },
            { id: "K", name: "ã€HCã‚¤ã‚¨ãƒ­ãƒ¼ã€‘", colors: ["#000000", "#FFFF00", "#FFFFFF"], desc: "ãƒ­ãƒ¼ãƒ“ã‚¸ãƒ§ãƒ³å‘ã‘è¶…é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ" },
            { id: "L", name: "ã€HCã‚·ã‚¢ãƒ³ã€‘", colors: ["#000000", "#00FFFF", "#FFFFFF"], desc: "ãƒ­ãƒ¼ãƒ“ã‚¸ãƒ§ãƒ³å‘ã‘è¶…é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ" }
        ]
    }
};

// --- State Management ---
let state = {
            theme: "",
            targetKey: "",
            patternId: "",
            udFont: true // Default true
        };

        // --- DOM Elements ---
        const els = {
            inputTheme: document.getElementById('input-theme'),
            inputUdFont: document.getElementById('input-udfont'),
            designSection: document.getElementById('design-section'),
            designContainer: document.getElementById('design-container'),
            btnGenerate: document.getElementById('btn-generate-proposal'),
            errorMsg: document.getElementById('error-msg'),
            phaseIndicator: document.getElementById('phase-indicator'),
            // Steps
            step0: document.getElementById('step-0'),
            stepOutput: document.getElementById('step-output'),
            // Phases
            phase0: document.getElementById('phase-0'),
            phase2: document.getElementById('phase-2'),
            // Final Output
            finalCode: document.getElementById('final-code')
        };

        // --- Event Listeners ---
        els.inputTheme.addEventListener('input', (e) => {
            state.theme = e.target.value;
            checkValidity();
        });

        els.inputUdFont.addEventListener('change', (e) => {
            state.udFont = e.target.checked;
        });

        function checkValidity() {
            if (state.theme && state.targetKey && state.patternId) {
                els.btnGenerate.disabled = false;
                els.btnGenerate.classList.remove('bg-gray-600', 'cursor-not-allowed', 'text-gray-400', 'border-gray-600');
                els.btnGenerate.classList.add('bg-blue-600', 'hover:bg-blue-500', 'cursor-pointer', 'text-white', 'border-blue-600', 'shadow-blue-900/50');
                els.errorMsg.classList.add('hidden');
            } else {
                els.btnGenerate.disabled = true;
                els.btnGenerate.classList.add('bg-gray-600', 'cursor-not-allowed', 'text-gray-400', 'border-gray-600');
                els.btnGenerate.classList.remove('bg-blue-600', 'hover:bg-blue-500', 'cursor-pointer', 'text-white', 'border-blue-600', 'shadow-blue-900/50');
            }
        }

        function selectTarget(key) {
            state.targetKey = key;
            state.patternId = ""; // Reset pattern when target changes
            
            // UI Update for Target Buttons
            document.querySelectorAll('.target-btn').forEach(btn => {
                if(btn.dataset.val === key) {
                    btn.classList.add('bg-blue-900', 'border-blue-500', 'ring-2', 'ring-blue-500', 'ring-offset-2', 'ring-offset-gray-800');
                    btn.classList.remove('bg-gray-700', 'border-gray-600');
                } else {
                    btn.classList.remove('bg-blue-900', 'border-blue-500', 'ring-2', 'ring-blue-500', 'ring-offset-2', 'ring-offset-gray-800');
                    btn.classList.add('bg-gray-700', 'border-gray-600');
                }
            });

            renderPatterns(key);
            els.designSection.classList.remove('hidden');
            checkValidity();
        }

        function renderPatterns(targetKey) {
            const data = designMatrix[targetKey];
            els.designContainer.innerHTML = '';

            data.patterns.forEach(p => {
                const btn = document.createElement('button');
                btn.className = 'design-btn relative flex flex-col items-start p-4 border rounded-xl hover:shadow-lg transition w-full text-left bg-gray-700 border-gray-600';
                btn.onclick = () => selectPattern(p.id, btn);
                
                // Color Preview Circles
                const colorDots = p.colors.map(c => 
                    `<span class="w-6 h-6 rounded-full border border-gray-600 shadow-sm" style="background-color: ${c};"></span>`
                ).join('');

                btn.innerHTML = `
                    <div class="flex gap-2 mb-3">${colorDots}</div>
                    <div class="font-bold text-gray-200 text-sm mb-1 line-clamp-1">${p.name}</div>
                    <div class="text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded border border-gray-600 w-full truncate">${p.desc}</div>
                `;
                els.designContainer.appendChild(btn);
            });
        }

        function selectPattern(id, btnElement) {
            state.patternId = id;
            
            // UI reset
            document.querySelectorAll('.design-btn').forEach(b => {
                b.classList.remove('ring-2', 'ring-blue-500', 'border-blue-500', 'bg-blue-900', 'ring-offset-2', 'ring-offset-gray-800');
                b.classList.add('bg-gray-700', 'border-gray-600');
            });
            // Active state
            btnElement.classList.remove('bg-gray-700', 'border-gray-600');
            btnElement.classList.add('ring-2', 'ring-blue-500', 'border-blue-500', 'bg-blue-900', 'ring-offset-2', 'ring-offset-gray-800');
            
            checkValidity();
        }

        // --- Flow Control ---

        function updateStepper(isOutputPhase) {
            // Step 1: Settings
            const div0 = els.step0.querySelector('div');
            const span0 = els.step0.querySelector('span');
            div0.className = 'w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold step-active transition-colors shadow-lg';
            span0.className = 'text-xs mt-2 font-bold text-blue-400';

            // Step 2: Output
            const divOut = els.stepOutput.querySelector('div');
            const spanOut = els.stepOutput.querySelector('span');
            
            if(isOutputPhase) {
                divOut.classList.remove('step-inactive');
                divOut.classList.add('step-active');
                spanOut.className = 'text-xs mt-2 font-bold text-blue-400';
            } else {
                divOut.classList.add('step-inactive');
                divOut.classList.remove('step-active');
                spanOut.className = 'text-xs mt-2 font-bold text-gray-500';
            }
        }

        function generateAndGoToOutput() {
            if(els.btnGenerate.disabled) return;

            generatePromptScript();

            els.phase0.classList.add('hidden');
            els.phase2.classList.remove('hidden');
            els.phaseIndicator.textContent = "å‡ºåŠ›";
            updateStepper(true);
            window.scrollTo(0,0);
        }

        function backToPhase0() {
            els.phase2.classList.add('hidden');
            els.phase0.classList.remove('hidden');
            els.phaseIndicator.textContent = "ã‚¹ãƒ©ã‚¤ãƒ‰ã®åŸºæœ¬è¨­å®š";
            updateStepper(false);
        }

        // --- Prompt Generation Logic ---

        function generatePromptScript() {
            const targetData = designMatrix[state.targetKey];
            const patternData = targetData.patterns.find(p => p.id === state.patternId);
            
            // AIã¸ã®æŒ‡ç¤ºæ›¸ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã‚’ä½œæˆ
            // ä½™è¨ˆãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šé™¤ã—ã€ç´”ç²‹ãªè¦ä»¶å®šç¾©ã®ã¿ã‚’å‡ºåŠ›ã™ã‚‹
            let script = ``;
            
            script += `# å…¥åŠ›æƒ…å ± (è¦ä»¶å®šç¾©)\n`;
            script += `- **ãƒ†ãƒ¼ãƒ:** ${state.theme}\n`;
            script += `- **å¯¾è±¡èª­è€…:** ${targetData.name}\n`;
            script += `- **é¸æŠã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³:** ${patternData.name} - ${patternData.desc}\n`;
            script += `- **ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ (HEX):** ${patternData.colors.join(', ')}\n`;
            if (state.udFont) {
                script += `- **UDãƒ•ã‚©ãƒ³ãƒˆ:** ä½¿ç”¨ã™ã‚‹ (BIZ UDPã‚´ã‚·ãƒƒã‚¯)\n`;
            } else {
                script += `- **UDãƒ•ã‚©ãƒ³ãƒˆ:** æŒ‡å®šãªã—\n`;
            }
            script += `\n`;

            script += `# ãƒ‡ã‚¶ã‚¤ãƒ³/ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¦ä»¶\n`;
            script += `1. **è¨€è‘‰é£ã„ã¨ãƒˆãƒ¼ãƒ³:** ${targetData.name}ã«åˆã‚ã›ã¦æœ€é©åŒ–ã—ã¦ãã ã•ã„ã€‚\n`;
            script += `   (ä¾‹: å°å­¦ç”Ÿãªã‚‰å¹³æ˜“ãªè¨€è‘‰ã¨ã€Œã§ã™ãƒ»ã¾ã™ã€ã€æ•™å“¡ãªã‚‰å…¬å¼æ–‡æ›¸çš„ãªãƒˆãƒ¼ãƒ³)\n`;
            script += `2. **é…è‰²:** æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ (${patternData.colors.join(', ')}) ã‚’å¿…ãšä½¿ç”¨ã—ã€ã‚¹ãƒ©ã‚¤ãƒ‰ã®èƒŒæ™¯è‰²ã€ãƒ†ã‚­ã‚¹ãƒˆè‰²ã€ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ã«é©ç”¨ã—ã¦ãã ã•ã„ã€‚\n`;
            
            if (state.udFont) {
                script += `3. **ãƒ•ã‚©ãƒ³ãƒˆ:** ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã«é…æ…®ã—ã€å¿…ãš **ã€ŒBIZ UDPã‚´ã‚·ãƒƒã‚¯ã€** ("BIZ UDPGothic") ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚`;
            } else {
                script += `3. **ãƒ•ã‚©ãƒ³ãƒˆ:** æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆï¼ˆ"Sawarabi Mincho", "M PLUS 1p" ç­‰ï¼‰ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ã€æ–‡å­—åŒ–ã‘ã‚’é˜²ã„ã§ãã ã•ã„ã€‚`;
            }

            els.finalCode.textContent = script;
        }

        function copyToClipboard() {
            const text = els.finalCode.textContent;
            
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            
            textarea.select();
            
            try {
                document.execCommand('copy');
                const btn = document.querySelector('button[onclick="copyToClipboard()"]');
                const originalHtml = btn.innerHTML;
                const originalClasses = btn.className;

                btn.innerHTML = '<i class="fas fa-check mr-1"></i> Copied!';
                // Switch to success gradient
                btn.className = "bg-gradient-to-r from-green-500 to-emerald-600 text-white text-base px-8 py-3 rounded-lg shadow-xl transition flex items-center gap-2 font-extrabold transform scale-105 border border-white/20";
                
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.className = originalClasses;
                }, 2000);
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            
            document.body.removeChild(textarea);
        }

    </script>
</body>
</html>
